!function(){"use strict"}(),angular.module("app",["app.controllers","app.services","ngRoute"]).config(["$routeProvider",function(e){e.when("/",{controller:"MainController",templateUrl:"main.html"}).when("/register",{controller:"RegisterController",templateUrl:"register.html"}).otherwise({controller:"NotFoundController",templateUrl:"not_found.html"})}]).run(["$rootScope","$location",function(e,t){var n="ws://"+t.host()+":"+t.port(),r=new WebSocket(n);r.onmessage=function(t){var n=JSON.parse(t.data),r="ws:"+n.topic;e.$broadcast(r,n.data)}}]),function(){"use strict"}(),angular.module("app.controllers",[]).controller("ApplicationController",["$scope","$location","SessionsService",function(e,t,n){e.$on("login",function(t,n){e.currentUser=n}),e.logout=function(){n.logout(),delete e.currentUser,t.path("register")}}]).controller("MainController",["$scope","$location","AlbumsService",function(e,t,n){e.albums=[],e.$on("ws:new public album",function(t,n){n.creator!==e.currentUser.username&&(e.albums.unshift(n),e.$apply())}),e.$on("ws:removed album",function(t,n){n.creator!==e.currentUser.username&&(_.remove(e.albums,{_id:n._id}),e.$apply())}),n.query().success(function(t){e.albums=t}).error(function(e,n){401===n&&t.path("/register")}),e.newAlbum={},e.saveAlbum=function(){return e.newAlbum.title&&e.newAlbum.artist?void n.save(e.newAlbum).success(function(t){e.albums.unshift(t),e.newAlbum={}}):void alert("Please enter a title and an artist.")},e.toggleStatus=function(t){n.toggleStatus(t._id,t["public"]).success(function(){_.find(e.albums,function(e){e._id===t._id&&(e["public"]=!e["public"])})})},e.deleteAlbum=function(t){n["delete"](t).success(function(){_.remove(e.albums,{_id:t})})}}]).controller("RegisterController",["$scope","$location","SessionsService",function(e,t,n){e.newUser={},e.register=function(){return e.newUser.username&&e.newUser.password?void n.register(e.newUser).success(function(){n.login(e.newUser.username,e.newUser.password).then(function(n){e.$emit("login",n.data.user),t.path("/")})}).error(function(e,t){alert(412===t?"Username already exists! Try another.":t+": "+e)}):void alert("Please enter a username and password")},e.login=function(r,o){n.login(r,o).then(function(n){e.$emit("login",n.data.user),t.path("/")})}}]).controller("NotFoundController",["$scope",function(e){e.message="Not found!"}]),function(){"use strict"}();var alert=alert;angular.module("app.services",[]).service("AlbumsService",["$http",function(e){this.query=function(){return e.get("/api/albums")},this.save=function(t){return e.post("/api/albums",t)},this.toggleStatus=function(t,n){return e.put("/api/albums/"+t,{"public":!n})},this["delete"]=function(t){return e["delete"]("/api/albums/"+t)}}]).service("SessionsService",["$http",function(e){this.register=function(t){return e.post("/api/users",t)},this.login=function(t,n){var r={username:t,password:n};return e.post("/api/sessions",r).success(function(t){return e.defaults.headers.common["x-auth"]=t.token,t}).error(function(e,t){404===t&&alert("Wrong username or password")})},this.logout=function(){delete e.defaults.headers.common["x-auth"]}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXJzLmpzIiwic2VydmljZXMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsImNvbnRyb2xsZXIiLCJ0ZW1wbGF0ZVVybCIsIm90aGVyd2lzZSIsInJ1biIsIiRyb290U2NvcGUiLCIkbG9jYXRpb24iLCJ1cmwiLCJob3N0IiwicG9ydCIsImNvbm5lY3Rpb24iLCJXZWJTb2NrZXQiLCJvbm1lc3NhZ2UiLCJldmVudCIsInBheWxvYWQiLCJKU09OIiwicGFyc2UiLCJkYXRhIiwiZXZlbnROYW1lIiwidG9waWMiLCIkYnJvYWRjYXN0IiwiJHNjb3BlIiwiU2Vzc2lvbnNTZXJ2aWNlIiwiJG9uIiwidXNlciIsImN1cnJlbnRVc2VyIiwibG9nb3V0IiwicGF0aCIsIkFsYnVtc1NlcnZpY2UiLCJhbGJ1bXMiLCJhbGJ1bSIsImNyZWF0b3IiLCJ1c2VybmFtZSIsInVuc2hpZnQiLCIkYXBwbHkiLCJfIiwicmVtb3ZlIiwiX2lkIiwicXVlcnkiLCJzdWNjZXNzIiwiZXJyb3IiLCJzdGF0dXMiLCJuZXdBbGJ1bSIsInNhdmVBbGJ1bSIsInRpdGxlIiwiYXJ0aXN0Iiwic2F2ZSIsImFsZXJ0IiwidG9nZ2xlU3RhdHVzIiwiZmluZCIsImN1cnJlbnRBbGJ1bSIsImRlbGV0ZUFsYnVtIiwiaWQiLCJuZXdVc2VyIiwicmVnaXN0ZXIiLCJwYXNzd29yZCIsImxvZ2luIiwidGhlbiIsInJlc3BvbnNlIiwiJGVtaXQiLCJtZXNzYWdlIiwic2VydmljZSIsIiRodHRwIiwidGhpcyIsImdldCIsInBvc3QiLCJjdXJyZW50U3RhdHVzIiwicHV0IiwicHVibGljIiwibG9naW5BdHRlbXB0IiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwidG9rZW4iXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsZ0JBR0FBLFFBQUFDLE9BQUEsT0FDQSxrQkFDQSxlQUNBLFlBR0FDLFFBQUEsaUJBQUEsU0FBQUMsR0FDQUEsRUFDQUMsS0FBQSxLQUFBQyxXQUFBLGlCQUFBQyxZQUFBLGNBQ0FGLEtBQUEsYUFBQUMsV0FBQSxxQkFBQUMsWUFBQSxrQkFDQUMsV0FBQUYsV0FBQSxxQkFBQUMsWUFBQSxzQkFHQUUsS0FBQSxhQUFBLFlBQUEsU0FBQUMsRUFBQUMsR0FDQSxHQUFBQyxHQUFBLFFBQUFELEVBQUFFLE9BQUEsSUFBQUYsRUFBQUcsT0FDQUMsRUFBQSxHQUFBQyxXQUFBSixFQUVBRyxHQUFBRSxVQUFBLFNBQUFDLEdBQ0EsR0FBQUMsR0FBQUMsS0FBQUMsTUFBQUgsRUFBQUksTUFDQUMsRUFBQSxNQUFBSixFQUFBSyxLQUVBZCxHQUFBZSxXQUFBRixFQUFBSixFQUFBRyxVQ3pCQSxXQUNBLGdCQUdBckIsUUFBQUMsT0FBQSxzQkFFQUksV0FBQSx5QkFBQSxTQUFBLFlBQUEsa0JBQUEsU0FBQW9CLEVBQUFmLEVBQUFnQixHQUNBRCxFQUFBRSxJQUFBLFFBQUEsU0FBQVYsRUFBQVcsR0FDQUgsRUFBQUksWUFBQUQsSUFHQUgsRUFBQUssT0FBQSxXQUNBSixFQUFBSSxlQUNBTCxHQUFBSSxZQUNBbkIsRUFBQXFCLEtBQUEsZ0JBSUExQixXQUFBLGtCQUFBLFNBQUEsWUFBQSxnQkFBQSxTQUFBb0IsRUFBQWYsRUFBQXNCLEdBQ0FQLEVBQUFRLFVBRUFSLEVBQUFFLElBQUEsc0JBQUEsU0FBQVYsRUFBQWlCLEdBQ0FBLEVBQUFDLFVBQUFWLEVBQUFJLFlBQUFPLFdBQ0FYLEVBQUFRLE9BQUFJLFFBQUFILEdBQ0FULEVBQUFhLFlBSUFiLEVBQUFFLElBQUEsbUJBQUEsU0FBQVYsRUFBQWlCLEdBQ0FBLEVBQUFDLFVBQUFWLEVBQUFJLFlBQUFPLFdBQ0FHLEVBQUFDLE9BQUFmLEVBQUFRLFFBQUFRLElBQUFQLEVBQUFPLE1BQ0FoQixFQUFBYSxZQUlBTixFQUFBVSxRQUNBQyxRQUFBLFNBQUFWLEdBQ0FSLEVBQUFRLE9BQUFBLElBRUFXLE1BQUEsU0FBQXZCLEVBQUF3QixHQUNBLE1BQUFBLEdBQ0FuQyxFQUFBcUIsS0FBQSxlQUtBTixFQUFBcUIsWUFFQXJCLEVBQUFzQixVQUFBLFdBQ0EsTUFBQXRCLEdBQUFxQixTQUFBRSxPQUFBdkIsRUFBQXFCLFNBQUFHLFdBS0FqQixHQUFBa0IsS0FBQXpCLEVBQUFxQixVQUNBSCxRQUFBLFNBQUFULEdBQ0FULEVBQUFRLE9BQUFJLFFBQUFILEdBQ0FULEVBQUFxQixrQkFQQUssT0FBQSx3Q0FXQTFCLEVBQUEyQixhQUFBLFNBQUFsQixHQUNBRixFQUFBb0IsYUFBQWxCLEVBQUFPLElBQUFQLEVBQUFBLFdBQUFTLFFBQUEsV0FDQUosRUFBQWMsS0FBQTVCLEVBQUFRLE9BQUEsU0FBQXFCLEdBQ0FBLEVBQUFiLE1BQUFQLEVBQUFPLE1BQ0FhLEVBQUFBLFdBQUFBLEVBQUFBLGdCQU1BN0IsRUFBQThCLFlBQUEsU0FBQUMsR0FDQXhCLEVBQUFBLFVBQUF3QixHQUFBYixRQUFBLFdBQ0FKLEVBQUFDLE9BQUFmLEVBQUFRLFFBQUFRLElBQUFlLFVBS0FuRCxXQUFBLHNCQUFBLFNBQUEsWUFBQSxrQkFBQSxTQUFBb0IsRUFBQWYsRUFBQWdCLEdBQ0FELEVBQUFnQyxXQUVBaEMsRUFBQWlDLFNBQUEsV0FDQSxNQUFBakMsR0FBQWdDLFFBQUFyQixVQUFBWCxFQUFBZ0MsUUFBQUUsYUFLQWpDLEdBQUFnQyxTQUFBakMsRUFBQWdDLFNBQ0FkLFFBQUEsV0FDQWpCLEVBQUFrQyxNQUFBbkMsRUFBQWdDLFFBQUFyQixTQUFBWCxFQUFBZ0MsUUFBQUUsVUFBQUUsS0FBQSxTQUFBQyxHQUNBckMsRUFBQXNDLE1BQUEsUUFBQUQsRUFBQXpDLEtBQUFPLE1BQ0FsQixFQUFBcUIsS0FBQSxTQUdBYSxNQUFBLFNBQUFvQixFQUFBbkIsR0FFQU0sTUFEQSxNQUFBTixFQUNBLHdDQUVBQSxFQUFBLEtBQUFtQixTQWZBYixPQUFBLHlDQW9CQTFCLEVBQUFtQyxNQUFBLFNBQUF4QixFQUFBdUIsR0FDQWpDLEVBQUFrQyxNQUFBeEIsRUFBQXVCLEdBQUFFLEtBQUEsU0FBQUMsR0FDQXJDLEVBQUFzQyxNQUFBLFFBQUFELEVBQUF6QyxLQUFBTyxNQUNBbEIsRUFBQXFCLEtBQUEsV0FLQTFCLFdBQUEsc0JBQUEsU0FBQSxTQUFBb0IsR0FDQUEsRUFBQXVDLFFBQUEsZ0JDaEhBLFdBQ0EsZUFHQSxJQUFBYixPQUFBQSxLQUVBbkQsU0FBQUMsT0FBQSxtQkFFQWdFLFFBQUEsaUJBQUEsUUFBQSxTQUFBQyxHQUNBQyxLQUFBekIsTUFBQSxXQUNBLE1BQUF3QixHQUFBRSxJQUFBLGdCQUdBRCxLQUFBakIsS0FBQSxTQUFBSixHQUNBLE1BQUFvQixHQUFBRyxLQUFBLGNBQUF2QixJQUdBcUIsS0FBQWYsYUFBQSxTQUFBSSxFQUFBYyxHQUNBLE1BQUFKLEdBQUFLLElBQUEsZUFBQWYsR0FBQWdCLFVBQUFGLEtBR0FILEtBQUFBLFVBQUEsU0FBQVgsR0FDQSxNQUFBVSxHQUFBQSxVQUFBLGVBQUFWLE9BSUFTLFFBQUEsbUJBQUEsUUFBQSxTQUFBQyxHQUNBQyxLQUFBVCxTQUFBLFNBQUE5QixHQUNBLE1BQUFzQyxHQUFBRyxLQUFBLGFBQUF6QyxJQUdBdUMsS0FBQVAsTUFBQSxTQUFBeEIsRUFBQXVCLEdBQ0EsR0FBQWMsSUFDQXJDLFNBQUFBLEVBQ0F1QixTQUFBQSxFQUdBLE9BQUFPLEdBQUFHLEtBQUEsZ0JBQUFJLEdBQ0E5QixRQUFBLFNBQUFtQixHQUVBLE1BREFJLEdBQUFRLFNBQUFDLFFBQUFDLE9BQUEsVUFBQWQsRUFBQWUsTUFDQWYsSUFFQWxCLE1BQUEsU0FBQW9CLEVBQUFuQixHQUNBLE1BQUFBLEdBQ0FNLE1BQUEsaUNBS0FnQixLQUFBckMsT0FBQSxpQkFDQW9DLEdBQUFRLFNBQUFDLFFBQUFDLE9BQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICd1c2Ugc3RyaWN0Jztcbn0oKSk7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXG4gICAgJ2FwcC5jb250cm9sbGVycycsXG4gICAgJ2FwcC5zZXJ2aWNlcycsXG4gICAgJ25nUm91dGUnXG5dKVxuXG4uY29uZmlnKGZ1bmN0aW9uICgkcm91dGVQcm92aWRlcikge1xuICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgIC53aGVuKCcvJywge2NvbnRyb2xsZXI6ICdNYWluQ29udHJvbGxlcicsIHRlbXBsYXRlVXJsOiAnbWFpbi5odG1sJ30pXG4gICAgICAgIC53aGVuKCcvcmVnaXN0ZXInLCB7Y29udHJvbGxlcjogJ1JlZ2lzdGVyQ29udHJvbGxlcicsIHRlbXBsYXRlVXJsOiAncmVnaXN0ZXIuaHRtbCd9KVxuICAgICAgICAub3RoZXJ3aXNlKHtjb250cm9sbGVyOiAnTm90Rm91bmRDb250cm9sbGVyJywgdGVtcGxhdGVVcmw6ICdub3RfZm91bmQuaHRtbCd9KTtcbn0pXG5cbi5ydW4oZnVuY3Rpb24gKCRyb290U2NvcGUsICRsb2NhdGlvbikge1xuICAgIHZhciB1cmwgPSAnd3M6Ly8nICsgJGxvY2F0aW9uLmhvc3QoKSArICc6JyArICRsb2NhdGlvbi5wb3J0KCk7XG4gICAgdmFyIGNvbm5lY3Rpb24gPSBuZXcgV2ViU29ja2V0KHVybCk7XG5cbiAgICBjb25uZWN0aW9uLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgcGF5bG9hZCA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XG4gICAgICAgIHZhciBldmVudE5hbWUgPSAnd3M6JyArIHBheWxvYWQudG9waWM7XG5cbiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KGV2ZW50TmFtZSwgcGF5bG9hZC5kYXRhKTtcbiAgICB9O1xufSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgJ3VzZSBzdHJpY3QnO1xufSgpKTtcblxuYW5ndWxhci5tb2R1bGUoJ2FwcC5jb250cm9sbGVycycsIFtdKVxuXG4uY29udHJvbGxlcignQXBwbGljYXRpb25Db250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBTZXNzaW9uc1NlcnZpY2UpIHtcbiAgICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uIChldmVudCwgdXNlcikge1xuICAgICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgU2Vzc2lvbnNTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICBkZWxldGUgJHNjb3BlLmN1cnJlbnRVc2VyO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgncmVnaXN0ZXInKTtcbiAgICB9O1xufSlcblxuLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBBbGJ1bXNTZXJ2aWNlKSB7XG4gICAgJHNjb3BlLmFsYnVtcyA9IFtdO1xuXG4gICAgJHNjb3BlLiRvbignd3M6bmV3IHB1YmxpYyBhbGJ1bScsIGZ1bmN0aW9uIChldmVudCwgYWxidW0pIHtcbiAgICAgICAgaWYgKGFsYnVtLmNyZWF0b3IgIT09ICRzY29wZS5jdXJyZW50VXNlci51c2VybmFtZSkge1xuICAgICAgICAgICAgJHNjb3BlLmFsYnVtcy51bnNoaWZ0KGFsYnVtKTtcbiAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgJHNjb3BlLiRvbignd3M6cmVtb3ZlZCBhbGJ1bScsIGZ1bmN0aW9uIChldmVudCwgYWxidW0pIHtcbiAgICAgICAgaWYgKGFsYnVtLmNyZWF0b3IgIT09ICRzY29wZS5jdXJyZW50VXNlci51c2VybmFtZSkge1xuICAgICAgICAgICAgXy5yZW1vdmUoJHNjb3BlLmFsYnVtcywge19pZDogYWxidW0uX2lkfSk7XG4gICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIEFsYnVtc1NlcnZpY2UucXVlcnkoKVxuICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoYWxidW1zKSB7XG4gICAgICAgICAgICAkc2NvcGUuYWxidW1zID0gYWxidW1zO1xuICAgICAgICB9KVxuICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWdpc3RlcicpO1xuLy8gICAgICAgICAgICAgICAgYWxlcnQoJ1lvdSBuZWVkIHRvIGJlIGxvZ2dlZCBpbiB0byBnbyBoZXJlIScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICRzY29wZS5uZXdBbGJ1bSA9IHt9O1xuXG4gICAgJHNjb3BlLnNhdmVBbGJ1bSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCEkc2NvcGUubmV3QWxidW0udGl0bGUgfHwgISRzY29wZS5uZXdBbGJ1bS5hcnRpc3QpIHtcbiAgICAgICAgICAgIGFsZXJ0KCdQbGVhc2UgZW50ZXIgYSB0aXRsZSBhbmQgYW4gYXJ0aXN0LicpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgQWxidW1zU2VydmljZS5zYXZlKCRzY29wZS5uZXdBbGJ1bSlcbiAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChhbGJ1bSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5hbGJ1bXMudW5zaGlmdChhbGJ1bSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLm5ld0FsYnVtID0ge307XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnRvZ2dsZVN0YXR1cyA9IGZ1bmN0aW9uIChhbGJ1bSkge1xuICAgICAgICBBbGJ1bXNTZXJ2aWNlLnRvZ2dsZVN0YXR1cyhhbGJ1bS5faWQsIGFsYnVtLnB1YmxpYykuc3VjY2VzcyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfLmZpbmQoJHNjb3BlLmFsYnVtcywgZnVuY3Rpb24gKGN1cnJlbnRBbGJ1bSkge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QWxidW0uX2lkID09PSBhbGJ1bS5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudEFsYnVtLnB1YmxpYyA9ICFjdXJyZW50QWxidW0ucHVibGljO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmRlbGV0ZUFsYnVtID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIEFsYnVtc1NlcnZpY2UuZGVsZXRlKGlkKS5zdWNjZXNzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF8ucmVtb3ZlKCRzY29wZS5hbGJ1bXMsIHtfaWQ6IGlkfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG59KVxuXG4uY29udHJvbGxlcignUmVnaXN0ZXJDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBTZXNzaW9uc1NlcnZpY2UpIHtcbiAgICAkc2NvcGUubmV3VXNlciA9IHt9O1xuXG4gICAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoISRzY29wZS5uZXdVc2VyLnVzZXJuYW1lIHx8ICEkc2NvcGUubmV3VXNlci5wYXNzd29yZCkge1xuICAgICAgICAgICAgYWxlcnQoJ1BsZWFzZSBlbnRlciBhIHVzZXJuYW1lIGFuZCBwYXNzd29yZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgU2Vzc2lvbnNTZXJ2aWNlLnJlZ2lzdGVyKCRzY29wZS5uZXdVc2VyKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIFNlc3Npb25zU2VydmljZS5sb2dpbigkc2NvcGUubmV3VXNlci51c2VybmFtZSwgJHNjb3BlLm5ld1VzZXIucGFzc3dvcmQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCByZXNwb25zZS5kYXRhLnVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAobWVzc2FnZSwgc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gNDEyKSB7IC8vIGJhZCByZXF1ZXN0OyB1c2VybmFtZSBleGlzdHNcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ1VzZXJuYW1lIGFscmVhZHkgZXhpc3RzISBUcnkgYW5vdGhlci4nKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhbGVydChzdGF0dXMgKyAnOiAnICsgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgU2Vzc2lvbnNTZXJ2aWNlLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCByZXNwb25zZS5kYXRhLnVzZXIpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn0pXG5cbi5jb250cm9sbGVyKCdOb3RGb3VuZENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlKSB7XG4gICAgJHNjb3BlLm1lc3NhZ2UgPSAnTm90IGZvdW5kISc7XG59KTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAndXNlIHN0cmljdCc7XG59KCkpO1xuXG52YXIgYWxlcnQgPSBhbGVydDtcblxuYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlcycsIFtdKVxuXG4uc2VydmljZSgnQWxidW1zU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCkge1xuICAgIHRoaXMucXVlcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvYWxidW1zJyk7XG4gICAgfTtcblxuICAgIHRoaXMuc2F2ZSA9IGZ1bmN0aW9uIChuZXdBbGJ1bSkge1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9hbGJ1bXMnLCBuZXdBbGJ1bSk7XG4gICAgfTtcblxuICAgIHRoaXMudG9nZ2xlU3RhdHVzID0gZnVuY3Rpb24gKGlkLCBjdXJyZW50U3RhdHVzKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvYWxidW1zLycgKyBpZCwge3B1YmxpYzogIWN1cnJlbnRTdGF0dXN9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZWxldGUgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnL2FwaS9hbGJ1bXMvJyArIGlkKTtcbiAgICB9O1xufSlcblxuLnNlcnZpY2UoJ1Nlc3Npb25zU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCkge1xuICAgIHRoaXMucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcikge1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHVzZXIpO1xuICAgIH07XG5cbiAgICB0aGlzLmxvZ2luID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgICB2YXIgbG9naW5BdHRlbXB0ID0ge1xuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbnMnLCBsb2dpbkF0dGVtcHQpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsneC1hdXRoJ10gPSByZXNwb25zZS50b2tlbjtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChtZXNzYWdlLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDQpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ1dyb25nIHVzZXJuYW1lIG9yIHBhc3N3b3JkJyk7IC8vIFRPRE86IGRvIHRoaXMgaW4gY29udHJvbGxlciBzb21laG93XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddO1xuICAgIH07XG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=